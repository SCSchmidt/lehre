---
title: "Lineare Regression"
author:
  - Schmidt, Sophie C.
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::word_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
bibliography: references.bib
csl: "../templates/journal-of-archaeological-science.csl" # Insert path for the bib-style
---


```{r setup, include=TRUE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = TRUE,
  comment = "#>",
  fig.path = "../figures/",
  fig.width=6, 
  fig.height=6
)
```

Pakete für heute:
```{r Pakete}
library(dplyr)
library(tidyr)
library(ggplot2)



if (!require("lsr")) install.packages("lsr")
library(lsr)

if (!require("ggpmisc")) install.packages("ggpmisc")
library(ggpmisc)

```


todo! das mit den Paketen da oben klären!

Wir erinnern uns, wir hatten bei der Korrelation geschaut, ob die Größe und das Gewicht der Piraten voneinander abhängen.



## Lineare Regression

Die lineare Regression legt eine "best-fit"-Linie zwischen die Punkte. Sie soll möglichst gut den Punktverlauf abbilden.

In R ist das ziemlich einfach, in dem ich einem Streudiagramm den geom_smooth-Befehl mit der Methode "lm" (linear model) hinzufüge. Der Befehl "se = FALSE" sagt aus, dass ich jetzt gern *kein* Konfidenzintervall (standard error) dazu visualisieren möchte.

```{r lin reg}
library(ggplot2)

ggplot(data = pirates)+
  geom_point(aes(x = weight, y = height))+
  geom_smooth( aes(x = weight, y = height), method = "lm",
              se = FALSE)
```

Einfach oder?

Dieses Diagramm können wir jetzt noch ein bisschen verbessern. Wir könnten 

1. doch das Konfidenzintervall angeben

2. dazuschreiben, wie diese Linie mathematisch beschrieben werden kann und angeben, wie der R²-Wert der Regression aussieht.

Also, fangen wir an mit 1.:

```{r lin reg + se}
ggplot(data = pirates)+
  geom_point(aes(x = weight, y = height))+
  geom_smooth( aes(x = weight, y = height), method = "lm",
              se = TRUE)
```
Denkbar einfach. Das Konfidenzintervall ist sehr schmal, was für eine gute Anpassung der Linie an die Punkte spricht.

Schauen wir uns doch einmal an, wie diese Linie mathematisch beschrieben werden und zusammen mit dem R²-Wert dem plot hinzugefügt werden kann.

Wir brauchen dafür das Paket "ggpmisc".

Dann fügen wir dem  bisherigen Plot (am besten ihr kopiert das bisherige einfach mit strg+c und strg+v) den Befehl "stat_poly_eq" hinzu. "Stat_poly_eq" kann die Statistik der equation (Formel) einfügen. Dafür braucht es erst einmal noch die  Eingabewerte der Regression (x =  und y = ), dann die Information, welcher Text als "label" in den Graphen hinzugefügt werden soll: Paste (füge ein) die Formel (..eq.label..,) und den R²-Wert (..adj.rr.label..) und separiere die beiden mit vier Leerzeichen (symbolisiert durch die Tilde). Formula  sind eine bestimmte Art von Objekten in R. An dieser Stelle sagt man mit  "formula = y~x", dass y  die abhängige Variable sein soll.  "parse = TRUE" bedeutet "ja bitte schreib es hin" und "size" gibt die Schriftgröße an. "label.y.npc"  platziert die Schrift und zwar auf der y-Achse nach Prozent (also in diesem Fall bei 70% der Y-Achse).


```{r lin reg + formel}
library(ggpmisc)
ggplot(data = pirates)+
  geom_point(aes(x = height, y = weight))+
  geom_smooth( aes(x = height, y = weight), method = "lm",
              se = TRUE)+
  stat_poly_eq(aes(x = weight, # schreib die formel dazu ("eq" = equation)
                   y = height, label =  paste(..eq.label.., 
                                  ..adj.rr.label..,
                                  sep = "~~~~")),
               formula = y~x, # y sei die abhängige Variable
               parse = TRUE,
               size = 3,
               label.y.npc = 0.7)

```

Rstudio gibt uns netterweise die Information 	"`geom_smooth()` using formula 'y ~ x'". Es weist uns darauf hin, dass die Frage, welche der beiden Variablen die abhängige ist, von Bedeutung ist. Wenn x- und y vertauscht werden, kommen nämlich andere R²-Werte und eine andere Regressionslinie heraus. Das ist logisch, weil ja auch andere Zahlen in die Berechnung einbezogen werden. Die Regressionslinie versucht ja am Ende immer eine Vorhersage für die abhängige Variable zu liefern. Wenn diese sich ändern, ändert sich natürlich alles.

Welche Variable die abhängige ist, sollte immer "theoretisch" begründet werden. Also mit Logik. In unserem Beispiel ist es recht einfach: Die Größe eines Menschen wird wohl kaum von seinem Gewicht abhängen. In anderen Fällen mag das komplizierter sein, aber wichtig ist immer, dass die Auswahl gut begründet wird und logisch ist.



Cool oder?

Wenn man diese Grafik noch mit Titel und schöner Achsenbeschriftung versieht, hat man echt eine publikationswürdige Grafik. 


**Aufgabe: Wiederholt das noch einmal mit den Pinguin-Schnabel-Daten! Probiert ruhig eine neue Platzierung der Formel. Vielleicht unten rechts?**
