---
title: "Korrelation und Regression"
author:
  - Schmidt, Sophie C.
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::word_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
bibliography: references.bib
csl: "../templates/journal-of-archaeological-science.csl" # Insert path for the bib-style
---


```{r setup, include=TRUE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = TRUE,
  comment = "#>",
  fig.path = "../figures/",
  fig.width=6, 
  fig.height=6
)
```

Pakete für heute:
```{r Pakete}

library(yarrr)
data(pirates)
```

Vorhin hatten wir das Thema Korrelation und dabei den R-Wert von Pearson-Bravais von der Größe und des Gewichts und der Pinguin-Schnabellänge und -dicke bestimmt


Jetzt erstellen wir noch eine Linare Regression daraus:

## Lineare Regression

Die lineare Regression legt eine "best-fit"-Linie zwischen die Punkte. Sie soll möglichst gut den Punktverlauf abbilden.

In R ist das ziemlich einfach, in dem ich einem Streudiagramm den geom_smooth-Befehl mit der Methode "lm" (linear model) hinzufüge. Der Befehl "se = FALSE" sagt aus, dass ich jetzt gern *kein* Konfidenzintervall (standard error) dazu visualisieren möchte.

```{r lin reg}
library(ggplot2)

ggplot(data = pirates)+
  geom_point(aes(x = height, y = weight))+
  geom_smooth(aes(x = height, y = weight), method = "lm",
              se = FALSE)
```

Einfach oder?

Dieses Diagramm können wir jetzt noch ein bisschen verbessern. Wir könnten 

1. doch das Konfidenzintervall angeben

2. dazuschreiben, wie diese Linie mathematisch beschrieben werden kann und angeben, wie der R²-Wert der Linie aussieht.

Also, fangen wir an mit 1.:

```{r lin reg + se}
ggplot(data = pirates)+
  geom_point(aes(x = height, y = weight))+
  geom_smooth(aes(x = height, y = weight), method = "lm",
              se = TRUE)
```
Denkbar einfach. Das Konfidenzintervall ist sehr schmal, was für eine gute Anpassung der Linie an die Punkte spricht.

Schauen wir uns doch einmal an, wie diese Linie mathematisch beschrieben werden und zusammen mit dem R²-Wert dem plot hinzugefügt werden kann.

Wir brauchen dafür das Paket "ggpmisc".

Dann fügen wir dem  bisherigen Plot (am besten ihr kopiert das bisherige einfach mit strg+c und strg+v) den Befehl "stat_poly_eq" hinzu. "Stat_poly_eq" kann die Statistik der equation (Formel) einfügen. Dafür braucht es erst einmal noch die  Eingabewerte der Regression (x =  und y = ), dann die Information, welcher Text als "label" in den Graphen hinzugefügt werden soll: Paste (füge ein) die Formel (..eq.label..,) und den R²-Wert (..adj.rr.label..) und separiere die beiden mit vier Leerzeichen (symbolisiert durch die Tilde). Formula  sind eine bestimmte Art von Objekten in R. An dieser Stelle sagt man mit  "formula = y~x", dass y  die abhängige Variable sein soll.  "parse = TRUE" bedeutet "ja bitte schreib es hin" und "size" gibt die Schriftgröße an. "label.y.npc"  platziert die Schrift und zwar auf der y-Achse nach Prozent (also in diesem Fall bei 70% der Y-Achse).


```{r lin reg + formel}

library(ggpmisc)


ggplot(data = pirates)+
  geom_point(aes(x = height, y = weight))+
  geom_smooth(aes(x = height, y = weight), method = "lm",
              se = FALSE)+
  stat_poly_eq(aes(x = height, y = weight, label =  paste(..eq.label.., 
                                  ..adj.rr.label..,
                                  sep = "~~~~")),
               formula = y~x, # y sei die abhängige Variable
               parse = TRUE,
               size = 3,
               label.y.npc = 0.7)

```

Cool oder?

Wenn man diese Grafik noch mit Titel und schöner Achsenbeschriftung versieht, hat man echt eine publikationswürdige Grafik. 

Achtet bei Regressionen immer darauf, was die abhängige Variable ist. Zwischen dem Gewicht und der Größe der Piraten kann es nur einen logischen Zusammenhang geben: Größe bestimmt Gewicht! Nicht das Gewicht die Größe. In anderen Fällen kann das anders sein, also unklar, in welcher der beiden Faktoren den anderen beeinflusst. Dann ist es sinnvoll zwei unterschiedliche Regressionen zu berechnen und die Abhängigkeit der Variablen umzudrehen. 

**Aufgabe:** Mit dem Pearson-Bravais-Test haben wir ja festgestellt, dass der Zusammenhang zwischen Schnabeldicke und -länge nur sehr klein zu sein scheint. Jetzt können wir an dieser Stelle einmal testen, ob die Werte besser werden, wenn wir die Pinguine getrennt nach Art untersuchen.
**Aufgabe: Erstellt jeweils zwei lineare Regressionen für zwei Arten der Pinguine für ihre Schnabeldicke und -länge und prüft, welcher der beiden Parameter eher von dem anderen abzuhängen scheint! **

```{r}
library(palmerpenguins)
data("penguins")
library(magrittr)
library(tidyr)
library(dplyr)

penguins %>%
  filter(species == "Chinstrap") %>%
ggplot()+
  geom_point(aes(x = bill_depth_mm, y = bill_length_mm))+
  geom_smooth(aes(x = bill_depth_mm, y = bill_length_mm), method = "lm",
              se = FALSE)+
  stat_poly_eq(aes(x = bill_depth_mm, y = bill_length_mm, label =  paste(..eq.label.., 
                                  ..adj.rr.label..,
                                  sep = "~~~~")),
               formula = y~x, # y sei die abhängige Variable
               parse = TRUE,
               size = 3,
               label.y.npc = 0.7)
```


